# 旅行模拟系统

## 背景

城市之间有三种交通工具（汽车、火车和飞机）相连，某旅客于某一时刻向系统提出旅行要求，系统根据该旅客的要求为其设计一条旅行线路并输出；系统能查询当前时刻旅客所处的地点和状态（停留城市/所在交通工具）。



## 功能需求

- 城市总数不少于10个 **[12个城市]**

-  建立汽车、火车和飞机的时刻表（航班表）

  – 有沿途到站及票价信息**[共863班车次]**

- 旅客的要求包括：起点、终点、途经某些城市和旅行策略

- 旅行策略有：

  – 最少费用策略：无时间限制，费用最少即可

  – 最少时间策略：无费用限制，时间最少即可

  – 限时最少费用策略：在规定的时间内所需费用最省

- 旅行模拟查询系统以时间为轴向前推移，每1秒左右向前推进1个小时(查询状态的请求不计时)

- 不考虑城市内换乘交通工具所需时间

- 系统时间精确到小时

- 建立日志文件，对旅客状态变化和键入等信息进行记录

- 用图形绘制地图，并在地图上反映出旅客的旅行过程



## 主要算法思想

### 解决费用最少需求

- 算法主体思想：由于不考虑时间因素，可以单纯的用Dijkstra算法，但是考虑到必经城市，我们考虑**采用Floyd算法**，原因如下：

  假设城市数为n，选择的必经城市数为m，必经城市数的全排列为m！，那么利用Dijkstra算法，需要运行(m + 1) * m! = (m + 1)!次Dijkstra算法，再选择出一条最省钱的路径，那么算法的时间复杂度为(m + 1)! \* n²。若采用Floyd算法，算法复杂度为n³,且Floyd算法将任意两地的最短路径都计算出来了，所以考虑必经城市时，只需要简单的拼接再比较。

- 算法步骤:

  (0)采用firstAdjMatrix矩阵，任意两地之间最多有一条费用最少的车次(航班)

  (1)若选择了必经城市则计算必经城市全排列(递归)

  (2)利用Floyd算法，计算出任意两地花费最少的路径

  (3)若选择了必经城市则对必经城市全排列的每一种情况进行拼接，选出最佳路径

  (4)根据最佳路径算出花费时间，花费金钱已经在选择最佳路径时得出

### 解决时间最少需求

- ·算法主体思想：在解决时间最少问题时，我们曾考虑仿照算法一利用Floyd算法，但是算法二需要考虑到时间因素，并不是各个航班时间的累加，和出发时间有关系，而Floyd算法是用每个点对整个图进行“疏松”操作，而我们现在只掌握了出发点的出发时间(非车次(航班)出发时间)，其它点的出发时间尚未掌握，所以不可以使用Floyd算法，于是我们决定采用Dijkstra算法，进行(m + 1)!运算，这也就是为什么要限制选择必经城市的数量

- 算法步骤

  (0)采用allAdjMatrix矩阵，具有所有车次(航班)的信息

  (1)若选择了必经城市则计算必经城市全排列(递归)

  (2)利用Dijkstra算法，计算出指定两地花费时间最少的路径

  **其中在利用A地更新其他城市时，需要得出A地到其他城市花费时间最少的车次(航班)，利用此车次(航班)进行比较和更新**

  (3)选择出花费时间最短的路径

  (4)根据最佳路径算出花费金钱，花费时间已经在选择最佳路径时得出

### 解决限时时间最少费用需求

- 算法主体思想：此问题是比较灵活的一个问题，给出的限时时间不同，得出的路线可能会不同，我们经过讨论，打算**先调用“最少花费”算法**，如果得出路径的时间小于限时，则最优路径为此路径；如果“最少花费”算法得出的路径的时间大于限时时间，那么**再调用“最少时间”算法**，如果得出的路径的时间大于限时时间，那么肯定没有满足条件的路径，如果得出的路径时间小于限时时间，那么我们**可能**得到了一个花费最少的最优解，我们可以利用其花费，在第三个算法的回溯法中，尽可能的剪枝来缩短搜索范围。

  剪枝的条件:

  (1)**超时剪枝**。当路线时间已经超过限制时间，回溯

  (2)**超费用剪枝**。和算法二得出的费用比较，大于则回溯 

  (3)**递归深度剪枝**。人为设置递归深度

- 算法步骤

  (0)采用allAdjMatrix矩阵，具有所有车次(航班)的信息

  (1)调用算法一，判断时间是否小于限制时间，如果小于则结束，不然进入(2)

  (2)调用算法二，判断时间是否大于限制时间，如果大于则结束，不然进入(3)

  (3)递归搜索，利用上述3种规则回溯

  (4)搜索到一条可行路径时，和“当前最优”路径比较，若更优则替换。回溯

  

## 示例

<img src="https://gitee.com/XiangYuBnr/BlogImage/raw/master/Image/20200904115343.png" alt="image-20200904115319053" style="zoom:80%;" />

<img src="https://gitee.com/XiangYuBnr/BlogImage/raw/master/Image/20200904115344.png" alt="image-20200904115255429" style="zoom:80%;" />





